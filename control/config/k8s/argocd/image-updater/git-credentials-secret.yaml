# =========================
# Git 写回凭证 Secret（占位符）
# =========================
# 注意：这是占位符配置，需要根据实际情况修改
#
# ArgoCD Image Updater 需要写回 Git 仓库来更新 image tags
# 因此需要 Git 仓库的写权限
#
# 使用说明：
# 1. 如果 Git 仓库是公开的，可以使用 GitHub Personal Access Token
# 2. 如果 Git 仓库是私有的，必须使用 Token 或 SSH key
# 3. Token 需要以下权限：
#    - repo (完整仓库访问权限，包括写权限)
#    - 或者至少需要 contents:write 权限
#
# 修改下面的占位符值：
#   - YOUR_GITHUB_USERNAME: 你的 GitHub 用户名
#   - YOUR_GITHUB_TOKEN: 你的 GitHub Personal Access Token
#
# 创建 GitHub Token 的方法：
#   1. GitHub -> Settings -> Developer settings -> Personal access tokens -> Tokens (classic)
#   2. Generate new token (classic)
#   3. 选择权限：repo (完整仓库访问)
#   4. 复制生成的 token

apiVersion: v1
kind: Secret
metadata:
  name: git-credentials
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-image-updater
type: Opaque
stringData:
  # 方式 1: 使用用户名和密码/Token
  username: YOUR_GITHUB_USERNAME
  password: YOUR_GITHUB_TOKEN
  
  # 方式 2: 使用 SSH key（如果使用 SSH URL）
  # ssh-privatekey: |
  #   -----BEGIN OPENSSH PRIVATE KEY-----
  #   YOUR_SSH_PRIVATE_KEY_CONTENT
  #   -----END OPENSSH PRIVATE KEY-----

---
# 配置 Image Updater 使用此 Secret
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: argocd
data:
  # Git 写回配置
  git.user: "YOUR_GITHUB_USERNAME"
  git.email: "YOUR_EMAIL@example.com"  # 用于 Git commit
  git.commit-message-template: |
    build: update {{.AppName}} image {{.ImageName}} to {{.NewTag}}
    
    [skip ci]
  
  # 可选：配置 registry 认证 Secret 名称
  # registries.conf: |
  #   - name: Docker Hub
  #     prefix: docker.io
  #     credentials: secret:argocd/docker-registry-secret#.dockerconfigjson
  #   - name: GitHub Container Registry
  #     prefix: ghcr.io
  #     credentials: secret:argocd/docker-registry-secret#.dockerconfigjson

