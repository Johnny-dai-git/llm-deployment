# =========================
# Git 写回凭证 Secret
# =========================
# ArgoCD Image Updater 需要写回 Git 仓库来更新 image tags
# 因此需要 Git 仓库的写权限

apiVersion: v1
kind: Secret
metadata:
  name: git-credentials
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-image-updater
type: Opaque
stringData:
  # 使用用户名和 Token
  username: Johnny-dai-git
  password: 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

---
# 配置 Image Updater 使用此 Secret
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: argocd
data:
  # Git 写回配置
  git.user: "Johnny-dai-git"
  git.email: "johnny-dai-git@users.noreply.github.com"  # GitHub no-reply email
  git.commit-message-template: |
    build: update {{.AppName}} image {{.ImageName}} to {{.NewTag}}
    
    [skip ci]
  
  # 配置 registry 认证 Secret
  registries.conf: |
    - name: GitHub Container Registry
      prefix: ghcr.io
      credentials: secret:argocd/docker-registry-secret#.dockerconfigjson

