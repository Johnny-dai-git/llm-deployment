<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LLM Chat Interface</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Ubuntu, sans-serif;
    background: linear-gradient(135deg,#667eea,#764ba2);
    height:100vh; display:flex; justify-content:center; align-items:center;
}
.container {
    background:white; border-radius:20px; width:90%; max-width:800px;
    height:80vh; display:flex; flex-direction:column;
    box-shadow:0 20px 60px rgba(0,0,0,.3);
}
.header {
    background: linear-gradient(135deg,#667eea,#764ba2);
    color:white; padding:20px; text-align:center;
    border-radius:20px 20px 0 0;
}
.chat-area {
    flex:1; padding:20px; overflow-y:auto; background:#f5f5f5;
}
.message { display:flex; margin-bottom:15px; }
.message.user { justify-content:flex-end; }
.message-content {
    max-width:70%; padding:12px 16px; border-radius:18px;
}
.user .message-content { background:#667eea; color:white; }
.assistant .message-content {
    background:white; color:#333; box-shadow:0 2px 5px rgba(0,0,0,.1);
}
.input-area {
    padding:20px; display:flex; gap:10px;
}
#messageInput {
    flex:1; padding:12px 16px; border-radius:25px; border:2px solid #e0e0e0;
}
#messageInput:focus { border-color:#667eea; outline:none; }
#sendButton {
    padding:12px 24px; border-radius:25px; border:none;
    background: linear-gradient(135deg,#667eea,#764ba2);
    color:white; font-weight:600; cursor:pointer;
}
#sendButton:disabled { opacity:.5; cursor:not-allowed; }
</style>
</head>

<body>
<div class="container">
    <div class="header">
        <h1>ðŸ¤– LLM Chat Interface</h1>
        <p id="modelInfo">Loading modelâ€¦</p>
    </div>

    <div class="chat-area" id="chatArea"></div>

    <div class="input-area">
        <input id="messageInput" placeholder="Type your message..."
               onkeypress="if(event.key==='Enter') sendMessage()">
        <button id="sendButton" onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
const API_BASE_URL = '/api';
let CURRENT_MODEL = 'qwen2.5-0.5b';
let msgId = 0;

/* === conversation state === */
let chatMessages = [
    { role:'assistant', content:'Hello! I am an AI assistant, how can I help you?' }
];

renderAll();

/* === load models once === */
window.onload = async () => {
    try {
        const r = await fetch(`${API_BASE_URL}/v1/models`);
        const j = await r.json();
        if (j.data?.length) CURRENT_MODEL = j.data[0].id;
    } catch {}
    document.getElementById('modelInfo').innerText = `Model: ${CURRENT_MODEL}`;
};

/* === send message === */
async function sendMessage() {
    const input = messageInput;
    const text = input.value.trim();
    if (!text) return;

    input.value = '';
    input.disabled = sendButton.disabled = true;

    chatMessages.push({ role:'user', content:text });
    renderAll();

    const thinkingIndex = chatMessages.length;
    chatMessages.push({ role:'assistant', content:'Thinkingâ€¦' });
    renderAll();

    try {
        const resp = await fetch(`${API_BASE_URL}/v1/chat/completions`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                model: CURRENT_MODEL,
                messages: chatMessages.slice(0, -1),
                max_tokens:512,
                temperature:0.7
            })
        });

        if (!resp.ok) {
            throw new Error(`API Error ${resp.status}`);
        }

        const data = await resp.json();
        chatMessages[thinkingIndex].content =
            data.choices?.[0]?.message?.content || 'No response';

    } catch (e) {
        chatMessages[thinkingIndex].content = `Error: ${e.message}`;
    }

    renderAll();
    input.disabled = sendButton.disabled = false;
    input.focus();
}

/* === render === */
function renderAll() {
    chatArea.innerHTML = '';
    for (const m of chatMessages) {
        const div = document.createElement('div');
        div.className = `message ${m.role}`;
        div.innerHTML = `<div class="message-content">${escape(m.content)}</div>`;
        chatArea.appendChild(div);
    }
    chatArea.scrollTop = chatArea.scrollHeight;
}

function escape(t) {
    const d = document.createElement('div');
    d.textContent = t;
    return d.innerHTML;
}
</script>
</body>
</html>
